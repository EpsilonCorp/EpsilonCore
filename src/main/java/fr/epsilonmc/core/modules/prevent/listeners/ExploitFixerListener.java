package fr.epsilonmc.core.modules.prevent.listeners;

import fr.epsilonmc.api.io.ChatOperations;
import fr.epsilonmc.core.Variables;
import org.bukkit.Material;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.inventory.InventoryClickEvent;
import org.bukkit.event.player.PlayerEditBookEvent;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;

public class ExploitFixerListener implements Listener {

    @EventHandler
    public void onPlayerEditBook(PlayerEditBookEvent event) {
        event.setCancelled(true);
        event.getPlayer().sendMessage(Variables.MESSAGE_PREVENT_ITEM_USE);
    }

    @EventHandler
    public void onInventoryClick(InventoryClickEvent event) {
        Player player = (Player)event.getWhoClicked();
        ItemStack itemStack = event.getCurrentItem();

        if (itemStack != null && (itemStack.getType() == Material.WRITTEN_BOOK || itemStack.getType() == Material.BOOK_AND_QUILL)) {
            event.setCancelled(true);
            player.sendMessage(Variables.MESSAGE_PREVENT_ITEM_USE);
            event.setCurrentItem(null);
        }
        if (itemStack != null && itemStack.getAmount() < 1)
            player.getInventory().setItemInHand(null);
    }

    @EventHandler
    public void onPlayerInteract(PlayerInteractEvent event) {
        Player player = event.getPlayer();
        Material material = event.getMaterial();

        if (material == Material.WRITTEN_BOOK || material == Material.BOOK_AND_QUILL) {
            event.setCancelled(true);
            player.sendMessage(Variables.MESSAGE_PREVENT_ITEM_USE);
            player.getInventory().setItemInHand(null);
        }
        if (event.getItem() != null && event.getItem().getAmount() < 1)
            player.getInventory().setItemInHand(null);
    }

}
